<%- include("./partials/head.ejs", { pageTitle: "Reels" }) %>

<style>
  body {
    margin: 0;
    background: linear-gradient(to bottom, #020617, #020617);
    color: white;
    font-family: 'Inter', sans-serif;
    height: 100vh;
    overflow: hidden;
  }

  .feed-container {
    max-width: 420px;
    margin: 0 auto;
    height: 100vh;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scrollbar-width: none;
    padding-top: 70px; /* navbar space */
  }

  .feed-container::-webkit-scrollbar {
    display: none;
  }

  .feed-item {
    height: 100vh;
    position: relative;
    scroll-snap-align: start;
    background: black;
    overflow: hidden;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Dark gradient overlay */
  .overlay {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 20px;
    padding-bottom: 130px;
    background: linear-gradient(to top, rgba(0,0,0,.9), transparent);
    z-index: 2;
  }

  .overlay h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
  }

  .overlay p {
    margin: 6px 0;
    font-size: 13px;
    color: #cbd5f5;
  }

  /* Right-side actions */
  .actions {
    position: absolute;
    right: 12px;
    bottom: 140px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 3;
    text-align: center;
  }

  .action-btn {
    background: none;
    border: none;
    font-size: 26px;
    cursor: pointer;
    color: white;
  }

  .action-btn.liked {
    color: #ff4d4d;
  }

  .action-count {
    font-size: 12px;
    color: #ddd;
  }

  /* Connect button FIXED */
  .cta-button {
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: 85%;
    padding: 14px;
    background: linear-gradient(135deg, #2563eb, #4f46e5);
    border: none;
    border-radius: 14px;
    font-size: 15px;
    font-weight: 600;
    color: white;
    cursor: pointer;
    z-index: 4;
    box-shadow: 0 10px 30px rgba(79,70,229,.4);
  }

  .cta-button:hover {
    filter: brightness(1.1);
  }
</style>

</head>

<body>

<%- include("./partials/navbar.ejs", { currentPage: "home", isLoggedIn, user }) %>

<div class="feed-container">

  <% if (!projects || projects.length === 0) { %>
    <div class="feed-item" style="display:flex;align-items:center;justify-content:center;">
      <p>No reels available</p>
    </div>
  <% } %>

  <% projects.forEach(project => { %>
    <div class="feed-item">

      <!-- FIXED iframe src -->
      <iframe
        src="<%= project.mediaURL %>"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen>
      </iframe>

      <!-- TEXT OVERLAY -->
      <div class="overlay">
        <h3><%= project.title %></h3>
        <p>Demo Content</p>
        <p>Squad: <strong><%= project.squadName %></strong></p>
        <p>
          Skills:
          <em><%= project.skillsUsed.join(" ‚Ä¢ ") %></em>
        </p>
      </div>

      <!-- ACTIONS -->
      <div class="actions">
        <div>
          <button
            class="action-btn"
            id="like-btn-<%= project._id %>"
            onclick="handleLike('<%= project._id %>')">
            ‚ù§Ô∏è
          </button>
          <div class="action-count" id="likes-<%= project._id %>"><%= project.likes %></div>
        </div>

        <div>
          <button
            class="action-btn"
            onclick="handleSave('<%= project._id %>')">
            ‚≠ê
          </button>
          <div class="action-count" id="saves-<%= project._id %>"><%= project.saves %></div>
        </div>
      </div>

      <!-- CTA -->
      <button
        class="cta-button"
        onclick="handleConnect('<%= project.squadName %>')">
        ü§ù Connect & DM
      </button>

    </div>
  <% }) %>

</div>

<script>
  function handleConnect(name) {
    alert("Opening chat with " + name);
  }

  function handleLike(id) {
    const likes = document.getElementById(`likes-${id}`);
    const btn = document.getElementById(`like-btn-${id}`);
    let count = parseInt(likes.innerText);

    if (btn.classList.contains("liked")) {
      likes.innerText = count - 1;
      btn.classList.remove("liked");
    } else {
      likes.innerText = count + 1;
      btn.classList.add("liked");
    }
  }

  function handleSave(id) {
    const saves = document.getElementById(`saves-${id}`);
    saves.innerText = parseInt(saves.innerText) + 1;
  }
</script>

</body>
